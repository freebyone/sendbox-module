---
- name: Debug Grafana installation
  hosts: grafana_servers
  become: yes
  vars:
    grafana_version: "12.2.2"

  tasks:
    - name: Check what variables are expected by the role
      include_vars: "shared-roles/grafana-ansible-collection/grafana-ansible-collection/roles/grafana/defaults/main.yml"
      run_once: true
      delegate_to: inventory_hostname

    - name: Debug role defaults
      debug:
        var: hostvars[inventory_hostname]
      run_once: true
      delegate_to: inventory_hostname

    - name: Include Grafana tasks with error handling
      block:
        - name: Include Grafana tasks
          include_tasks: "shared-roles/grafana-ansible-collection/grafana-ansible-collection/roles/grafana/tasks/main.yml"
      rescue:
        - name: Show error details
          debug:
            msg: "Grafana role failed, check required variables"