---
postgresql_version: 15

postgresql_listen_addresses: "localhost"
postgresql_max_connections: 100
postgresql_shared_buffers: "128MB"
postgresql_effective_cache_size: "1GB"

postgresql_databases:
  - name: postgres
    encoding: UTF8
    lc_collate: en_US.UTF-8
    lc_ctype: en_US.UTF-8

  - name: postgres
    password: "vault_path"
    role_flags: "SUPERUSER,CREATEDB,LOGIN"
    databases: [postgres]

postgresql_pg_hba_config:
  - { type: local, database: all, user: postgres, auth_method: trust }
  - { type: local, database: all, user: all, auth_method: trust }
  - { type: host, database: all, user: all, address: "127.0.0.1/32", auth_method: md5 }
  - { type: host, database: all, user: all, address: "::1/128", auth_method: md5 }
  - { type: host, database: all, user: all, address: "192.168.56.0/24", auth_method: md5 }

patroni_cluster_name: "postgres-cluster"

databases:
  - name: app
    owner: user
  - name: monitoring
    owner: postgres

users:
  - name: user
    password: "{{ vault_app_password }}"
  - name: readuser
    password: "{{ vault_read_password }}"
    privileges: ["LOGIN"]

pgbouncer_databases:
  - name: myapp
  - name: monitoring

etcd_client_port: 2379
etcd_peer_port: 2380
patroni_restapi_port: 8008
postgresql_port: 5432
pgbouncer_port: 6432
haproxy_frontend_port: 5000