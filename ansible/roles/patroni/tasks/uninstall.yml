---
- name: Stop and disable Patroni service
  systemd:
    name: "{{ patroni_cluster_name }}"
    state: stopped
    enabled: no
  ignore_errors: true

- name: Remove Patroni systemd service
  file:
    path: "/etc/systemd/system/{{ patroni_cluster_name }}.service"
    state: absent
  ignore_errors: true

- name: Remove Patroni container
  docker_container:
    name: "{{ patroni_cluster_name }}"
    state: absent
    force_kill: yes
  ignore_errors: true

- name: Remove Patroni Docker image
  docker_image:
    name: "{{ patroni_docker_image }}"
    state: absent
  ignore_errors: true

- name: Remove base directory (optional)
  file:
    path: "{{ patroni_base_dir }}"
    state: absent
  ignore_errors: true

- name: Reload systemd daemon
  systemd:
    daemon_reload: yes

- name: Confirm cleanup
  debug:
    msg: "Patroni cluster has been completely removed from {{ inventory_hostname }}"